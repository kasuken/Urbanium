@page "/world"
@inject WorldEngine WorldEngine

<PageTitle>World State</PageTitle>

<MudText Typo="Typo.h4" Class="mb-4">World State</MudText>
<MudText Typo="Typo.subtitle1" Class="mb-4" Color="Color.Secondary">
    The world state is explicit and versioned. It is the single source of truth.
</MudText>

<MudGrid>
    <MudItem xs="12" md="6">
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">
                <MudIcon Icon="@Icons.Material.Filled.Schedule" Class="mr-2" />Time State
            </MudText>
            <MudSimpleTable Dense="true">
                <tbody>
                    <tr>
                        <td><strong>Current Tick</strong></td>
                        <td>@WorldEngine.State.CurrentTick</td>
                    </tr>
                    <tr>
                        <td><strong>Simulation Time</strong></td>
                        <td>@WorldEngine.State.Time.ToString("yyyy-MM-dd HH:mm:ss")</td>
                    </tr>
                    <tr>
                        <td><strong>Seed</strong></td>
                        <td>@WorldEngine.State.Seed</td>
                    </tr>
                    <tr>
                        <td><strong>Working Hours</strong></td>
                        <td>
                            @if (WorldEngine.State.IsWorkingHours)
                            {
                                <MudChip T="string" Size="Size.Small" Color="Color.Success">Yes (9:00 - 17:00)</MudChip>
                            }
                            else
                            {
                                <MudChip T="string" Size="Size.Small" Color="Color.Default">No</MudChip>
                            }
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Daytime</strong></td>
                        <td>
                            @if (WorldEngine.State.IsDaytime)
                            {
                                <MudIcon Icon="@Icons.Material.Filled.WbSunny" Color="Color.Warning" />
                            }
                            else
                            {
                                <MudIcon Icon="@Icons.Material.Filled.NightsStay" Color="Color.Primary" />
                            }
                        </td>
                    </tr>
                </tbody>
            </MudSimpleTable>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" md="6">
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">
                <MudIcon Icon="@Icons.Material.Filled.Inventory" Class="mr-2" />System Counts
            </MudText>
            <MudSimpleTable Dense="true">
                <tbody>
                    <tr>
                        <td><MudIcon Icon="@Icons.Material.Filled.People" Size="Size.Small" Class="mr-2" />Citizens</td>
                        <td>@WorldEngine.State.Citizens.Count</td>
                    </tr>
                    <tr>
                        <td><MudIcon Icon="@Icons.Material.Filled.Home" Size="Size.Small" Class="mr-2" />Households</td>
                        <td>@WorldEngine.State.Households.Count</td>
                    </tr>
                    <tr>
                        <td><MudIcon Icon="@Icons.Material.Filled.Business" Size="Size.Small" Class="mr-2" />Employers</td>
                        <td>@WorldEngine.State.Employers.Count</td>
                    </tr>
                    <tr>
                        <td><MudIcon Icon="@Icons.Material.Filled.Map" Size="Size.Small" Class="mr-2" />Districts</td>
                        <td>@WorldEngine.State.Geography.Districts.Count</td>
                    </tr>
                    <tr>
                        <td><MudIcon Icon="@Icons.Material.Filled.AccountBalance" Size="Size.Small" Class="mr-2" />Public Services</td>
                        <td>@WorldEngine.State.PublicServices.Count</td>
                    </tr>
                </tbody>
            </MudSimpleTable>
        </MudPaper>
    </MudItem>
</MudGrid>

<MudGrid Class="mt-4">
    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">
                <MudIcon Icon="@Icons.Material.Filled.Work" Class="mr-2" />Labor Market
            </MudText>
            <MudSimpleTable Dense="true">
                <tbody>
                    <tr>
                        <td>Open Positions</td>
                        <td>@WorldEngine.State.LaborMarket.OpenPositions.Count</td>
                    </tr>
                    <tr>
                        <td>Average Wage</td>
                        <td>@WorldEngine.State.LaborMarket.AverageWage.ToString("C0")</td>
                    </tr>
                    <tr>
                        <td>Unemployment Rate</td>
                        <td>@WorldEngine.State.LaborMarket.UnemploymentRate.ToString("P1")</td>
                    </tr>
                </tbody>
            </MudSimpleTable>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">
                <MudIcon Icon="@Icons.Material.Filled.Apartment" Class="mr-2" />Housing Market
            </MudText>
            <MudSimpleTable Dense="true">
                <tbody>
                    <tr>
                        <td>Total Units</td>
                        <td>@WorldEngine.State.HousingMarket.AvailableUnits.Count</td>
                    </tr>
                    <tr>
                        <td>Available Units</td>
                        <td>@WorldEngine.State.HousingMarket.AvailableUnits.Count(u => !u.IsOccupied)</td>
                    </tr>
                    <tr>
                        <td>Average Rent</td>
                        <td>@WorldEngine.State.HousingMarket.AverageRent.ToString("C0")</td>
                    </tr>
                    <tr>
                        <td>Vacancy Rate</td>
                        <td>@WorldEngine.State.HousingMarket.Vacancy.ToString("P1")</td>
                    </tr>
                </tbody>
            </MudSimpleTable>
        </MudPaper>
    </MudItem>
    
    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">
                <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Class="mr-2" />Goods Market
            </MudText>
            <MudSimpleTable Dense="true">
                <tbody>
                    <tr>
                        <td>Food Price Index</td>
                        <td>@WorldEngine.State.GoodsMarket.FoodPriceIndex.ToString("F2")</td>
                    </tr>
                    <tr>
                        <td>Supply Level</td>
                        <td>
                            <MudProgressLinear Color="Color.Success" Value="@(WorldEngine.State.GoodsMarket.SupplyLevel * 100)" />
                        </td>
                    </tr>
                </tbody>
            </MudSimpleTable>
        </MudPaper>
    </MudItem>
</MudGrid>

<MudPaper Class="pa-4 mt-4" Elevation="2">
    <MudText Typo="Typo.h6" Class="mb-4">
        <MudIcon Icon="@Icons.Material.Filled.Event" Class="mr-2" />Recent Events
    </MudText>
    
    @if (WorldEngine.State.Events.Count == 0)
    {
        <MudAlert Severity="Severity.Info">No events recorded yet.</MudAlert>
    }
    else
    {
        <MudTimeline TimelinePosition="TimelinePosition.Start">
            @foreach (var evt in WorldEngine.State.Events.TakeLast(10).Reverse())
            {
                <MudTimelineItem Color="Color.Primary" Size="Size.Small">
                    <MudText Typo="Typo.caption">Tick @evt.Tick - @evt.Time.ToString("HH:mm")</MudText>
                    <MudText Typo="Typo.body2"><strong>@evt.Type:</strong> @evt.Description</MudText>
                </MudTimelineItem>
            }
        </MudTimeline>
    }
</MudPaper>
